---
title: "Preliminary Research Findings"
subtitle: "Cancel the Contract Project"
author: "By Catalyst California"
output:
  html_document:
    css: "W:\\RDA Team\\R\\cc_brandguide.css"
    toc: yes
    toc_depth: 3
    toc_float: yes
date: "`r format(Sys.time(), '%d %B, %Y')`"
---
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

```{r, include=FALSE}

knitr::opts_chunk$set(message=FALSE, echo=FALSE)

# Set up (add any additional libraries you may need)-----------------------------

library(RPostgres)
library(devtools)
library(stringr)
library(dplyr)
library(tidyr)
library(flextable)
library(ggplot2)
library(tidycensus)


#connect to postgres-------------

source("W:\\RDA Team\\R\\credentials_source.R")
con <- connect_to_db("cancel_the_contract")
con_shared <- connect_to_db("rda_shared_data")
con_fresno<- connect_to_db("eci_fresno_ripa")
con_rc<-connect_to_db("racecounts")

# data dictionary
dict<-dbGetQuery(con, "SELECT * FROM data_dictionary")

# Visualization tools (optional!)-------------------------

#add function that better fits the tables to the page

FitFlextableToPage <- function(ft, pgwidth = 6.5){

  ft_out <- ft %>% autofit()

  ft_out <- width(ft_out, width = dim(ft_out)$widths*pgwidth /(flextable_dim(ft_out)$widths))
  return(ft_out)
}


```

# I.	Executive Summary/Main Narrative

All people in the AV deserve to live in safety.  This includes freedom from police violence, as well as conditions that create well-being and opportunities to thrive.  For people of color, especially Black and Latinx youth, safety is often undermined by LA Sheriff’s Department (LASD) and high school district practices that push youth of color out of schools and into the criminal legal system (such as disproportionate suspensions, expulsions, and arrests).  More broadly, for Black and Latinx AV residents, a sense safety is undermined by inequities in other sectors, such as housing and economic insecurity. 

## A. Summary of research findings

Below is a summary of our preliminary research findings. All of the data can be explored more in-depth throughout the page: 

Education data shows that __students of color are being funneled out of the classroom through expulsions and suspensions__. Black students experience the highest rate of suspensions relative to all other student groups. Students with disabilities are also being suspended out of AVUHSD schools at high rates. Conversely, these student groups also have __lower graduation rates compared to White students__. These disparities demonstrate the systemic biases that are harming students of color, and the urgent need for more investments in better school supports and counseling. 

Police activity is analyzed using the [LASD RIPA data set](https://data.lacounty.gov/datasets/lacounty::sheriff-officer-contacts-person-details-/about). RIPA data contains information that police officers are legally required to input for each police stop they make. Because RIPA data is only input by police officers, it is important to note that the data is only based on officer perceptions and therefore can contain errors and under reporting. The RIPA data cannot capture the experiences of those being stopped by officers. 

Preliminary research findings show that __Black and Latinx youth are disproportionately being stopped by police in Antelope Valley Union High School District (AVUHSD) schools__. Black students in particular are being disproportionately impacted by police relative to their over-all enrollment in AVUHSD. Stops of students with disabilities are severely under-reported in the RIPA data. 

The majority of people stopped in AVUHSD schools are __stopped for reasons related to school fighting or possession of marijuana__. Additional stop reasons include non-serious offenses such as jaywalking or violating education codes.

The results of people being stopped in AVUHSD schools further corroborates that police activity is not being used to prevent serious crime. __Most stops in AVUHSD schools result in an in field cite and release__, or some form of __referral to a parent, guardian or school administrator__. 

The racial disparities in police stops extend beyond AVUHSD schools to the greater Antelope Valley region. Police disproportionately stop people they perceive as Black relative to the general Black population in the Antelope Valley. __People perceived as Latinx by police make up nearly half of all the stops police make in the Antelope Valley__. 

# II. Background / Context of AV

## A.	Describe how the AV is a diverse place. 

```{r}

# AV Demographic tables

av_race<-dbGetQuery(con, "SELECT * FROM av_population_race")%>%
  filter(!grepl("nh_asian_wo_sa|nh_aian|nh_nhpi", race))%>%
  mutate(race_label=ifelse(race %in% 'aian', 'AIAN',
                          ifelse(race %in% 'latino', 'Latinx',
                                        ifelse(race %in% 'nh_asian', 'Asian',
                                               ifelse(race %in% 'nh_black', 'Black',
                                               ifelse(race %in% 'nh_other', 'Other',
                                                      ifelse(race %in% 'nh_twoormor', 'Multiracial',
                                                             ifelse(race %in% 'nh_white', 'White',
                                                                    ifelse(race %in% 'nhpi', 'NHPI',
                                                                           ifelse(race %in% 'sswana', 'SSWANA', "NULL"))))))))))


                       
av_age<-dbGetQuery(con, "SELECT * FROM av_population_age")

```

We define the Antelope Valley (AV) geographic region as SPA 1. The AV has a __large youth population__ over-all, at __27.5% of the total population__. By comparison, 20.9% of LA county's population is age 0-17. The AV is also racially diverse, with Latinx people making up more than half of the total population. 

```{r}

df<-av_age%>%
  mutate(rate=round(rate,1))%>%
  select(age_re, total, count, rate)%>%
  rename("Age"="age_re")%>%
    rename_with(~ str_replace_all(.x, "_", " ") %>%
                str_to_lower() %>%
                str_replace("^\\w", ~ toupper(.x)))



  # Pull in county age data for comparison
  
  age_data <- dbGetQuery(con_shared, "SELECT * FROM demographics.acs_5yr_s0101_multigeo_2023 WHERE geoid = '06037' AND geolevel ='county' ")%>%
select(s0101_c01_001e	, s0101_c01_022e)%>%
    mutate(rate=s0101_c01_022e/s0101_c01_001e*100)
  
  # ##Flextable for Age Group##


  flextable(df) %>%
  set_caption('Antelope Valley Age Demographics') %>%
  theme_vanilla() %>%
  width(width=2,unit="in")
  
```

```{r}

title_text<-"The majority of residents in the AV are Latinx, White and Black"
subtitle_text<-"Race Demographics in Antelope Valley"
caption_text<-paste0("All racial groups are non-inclusive of Latinx except for AIAN, NHPI and SSWANA. AIAN=American Indian/Alaskan Native; NHPI=Native Hawaiian/Pacific Islander;SSWANA=South Asian, Southwest Asian and North Africa. \nData Source: ",dict$source[dict$indicator_short=="Race"])

#graph

ggplot(av_race, aes(x = reorder(race_label, rate), y = rate))+
  geom_bar(stat = "identity", fill = "#362178") + #to create barplot
  geom_text(aes(label = paste0(round(rate,1), "%")), #add percentage labels within the bars
          vjust=.5, #center percentage within the bar
          hjust=0,
          size = 4,
          color = "black")+ 
  scale_x_discrete(labels = ~ str_wrap(as.character(.x), 7))+
  labs(title = title_text, 
       subtitle = subtitle_text,
       caption = caption_text,
       x = "", #labels to visual
       y = "") +
  theme_bw()+
  theme(axis.text.x = element_text(angle = 0, hjust =0.5), #sets x-axis labels to be horizontal
      legend.position ="none", #removes legend
      plot.title = element_text(hjust=0.5),
      plot.subtitle = element_text(hjust=0.5),
       plot.caption = element_text(hjust = 0))+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=0.5, size=12), 
        strip.background = element_rect(fill = "#362178"),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
panel.background = element_blank())+
  coord_flip()+
     ylim(0, max(av_race$rate) * 1.1)



```

Our education analysis for the AV focuses on the Antelope Valley Union High School District (AVUHSD). Enrollment data for AVUHSD is for the 2024-2025 academic year. In AVUHSD there are more Black and Latinx students than White students. __Students with disabilities have a 17.8% enrollment rate__ in AVUHSD.

Comparatively, LA county student enrollment also has a high proportion of Latinx students at 65.2% compared to 67.2% in AVUHSD. However, the __Black student enrollment rate for LA county is only 6.7%, compared to 16.6% in AVUHSD.__ Additionally, __students with disabilities make up 14.8% of total student enrollment in LA county.__ 

```{r}

# AVUHSD Enrollment Data

enrollment <- dbGetQuery(con_shared, "SELECT * FROM education.cde_multigeo_enrollment_census_day_2024_25")

# get LAC enrollment
lac_enr<-enrollment%>%
  filter(aggregatelevel=="C" & countycode=="19" & charter == "ALL" )%>%
    filter(grepl("RE_|TA|SG_DS", reportingcategory))%>%
   mutate(total = total_enr[reportingcategory == "TA"])%>%
  filter(!grepl("TA", reportingcategory))%>%
   mutate(reportingcategory_re=ifelse(reportingcategory %in% "RE_B", "nh_black",
                                     ifelse(reportingcategory %in% "RE_I", "nh_aian", 
                                            ifelse(reportingcategory %in% "RE_A", "nh_asian", 
                                                   ifelse(reportingcategory %in% "RE_F", "nh_filipino",  
                                                          ifelse(reportingcategory %in% "RE_H", "latinx", 
                                                                 ifelse(reportingcategory %in% "RE_D", "missing_race",
                                                                        ifelse(reportingcategory %in% "RE_P", "nh_nhpi",  
                                                                               ifelse(reportingcategory %in% "RE_T", "nh_twoormor",  
                                                                                      ifelse(reportingcategory %in% "RE_W", "nh_white", 
                                                                                             reportingcategory))))))))))%>%
    mutate(race_label=ifelse(reportingcategory %in% "RE_B", "Black",
                                     ifelse(reportingcategory %in% "RE_I", "AIAN", 
                                            ifelse(reportingcategory %in% "RE_A", "Asian", 
                                                   ifelse(reportingcategory %in% "RE_F", "Filipinx",  
                                                          ifelse(reportingcategory %in% "RE_H", "Latinx", 
                                                                 ifelse(reportingcategory %in% "RE_D", "Missing race",
                                                                        ifelse(reportingcategory %in% "RE_P", "NHPI",  
                                                                               ifelse(reportingcategory %in% "RE_T", "Multiracial",  
                                                                                      ifelse(reportingcategory %in% "RE_W", "White", 
                                                                                             reportingcategory))))))))))%>%
  
  select(race_label, total_enr, total)%>%
  mutate(rate=total_enr/total*100)%>%
  arrange(-rate)


# get Antelope Valley Union High School District enrollment------------------
av_enrollment <- enrollment %>% filter(districtname == "Antelope Valley Union High" & charter == "ALL")%>%
  filter(grepl("RE_|TA", reportingcategory))%>%
  mutate(total = total_enr[reportingcategory == "TA"])%>%
  filter(!grepl("TA", reportingcategory))


# recode racial categories

av_enrollment<-av_enrollment%>%
  mutate(reportingcategory_re=ifelse(reportingcategory %in% "RE_B", "nh_black",
                                     ifelse(reportingcategory %in% "RE_I", "nh_aian", 
                                            ifelse(reportingcategory %in% "RE_A", "nh_asian", 
                                                   ifelse(reportingcategory %in% "RE_F", "nh_filipino",  
                                                          ifelse(reportingcategory %in% "RE_H", "latinx", 
                                                                 ifelse(reportingcategory %in% "RE_D", "missing_race",
                                                                        ifelse(reportingcategory %in% "RE_P", "nh_nhpi",  
                                                                               ifelse(reportingcategory %in% "RE_T", "nh_twoormor",  
                                                                                      ifelse(reportingcategory %in% "RE_W", "nh_white", 
                                                                                             reportingcategory))))))))))%>%
    mutate(race_label=ifelse(reportingcategory %in% "RE_B", "Black",
                                     ifelse(reportingcategory %in% "RE_I", "AIAN", 
                                            ifelse(reportingcategory %in% "RE_A", "Asian", 
                                                   ifelse(reportingcategory %in% "RE_F", "Filipinx",  
                                                          ifelse(reportingcategory %in% "RE_H", "Latinx", 
                                                                 ifelse(reportingcategory %in% "RE_D", "Missing race",
                                                                        ifelse(reportingcategory %in% "RE_P", "NHPI",  
                                                                               ifelse(reportingcategory %in% "RE_T", "Multiracial",  
                                                                                      ifelse(reportingcategory %in% "RE_W", "White", 
                                                                                             reportingcategory))))))))))%>%
  
  select(districtname, race_label, total_enr, total)%>%
  mutate(rate=total_enr/total*100)%>%
  arrange(-rate)

# Graph-------------------------

title_text<-"The majority of students enrolled in AVUHSD are Latinx and Black"
subtitle_text<-"Race Demographics in AVUHSD"
caption_text<-paste0("All racial groups are non-inclusive of Latinx. AIAN=American Indian/Alaskan Native; NHPI=Native Hawaiian/Pacific Islander. \nData Source: ",dict$source[dict$indicator_short=="Student Race"])

#graph

ggplot(av_enrollment, aes(x = reorder(race_label, rate), y = rate))+
  geom_bar(stat = "identity", fill = "#362178") + #to create barplot
  geom_text(aes(label = paste0(round(rate,1), "%")), #add percentage labels within the bars
          vjust=.5, #center percentage within the bar
          hjust=0,
          size = 4,
          color = "black")+ 
  scale_x_discrete(labels = ~ str_wrap(as.character(.x), 5))+
  labs(title = title_text, 
       subtitle = subtitle_text,
       caption = caption_text,
       x = "", #labels to visual
       y = "") +
  theme_bw()+
  theme(axis.text.x = element_text(angle = 0, hjust =0.5, size=5), #sets x-axis labels to be horizontal
      legend.position ="none", #removes legend
      plot.title = element_text(hjust=0.5),
      plot.subtitle = element_text(hjust=0.5),
       plot.caption = element_text(hjust = 0))+
  theme(axis.text.x = element_text(angle = 0, vjust = 0.5, hjust=0.5, size=12), 
        strip.background = element_rect(fill = "#362178"),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
panel.background = element_blank())+
  coord_flip()+
      ylim(0, max(av_enrollment$rate) * 1.1)




```

# III. The AV Union High School District and LA Sheriff’s Department undermine safety in the AV by harming Black and Latinx youth, and youth with disabilities.  This occurs through practices that push them out of school and into the criminal legal system, such as suspensions, expulsions, stops and arrests. (also known as the school-to-prison pipeline).

## A.	Schools disproportionately push Black and Latinx youth, as well as SWDs out of the classroom

Students with disabilities have a __lower graduation rate at 60.4%__, demonstrating that these students should be having more time in classrooms and less time interacting with police. 
Latinx (79.4%) and Black students (72.7%) have __lower graduation rates__ relative to other racial groups and they are the majority of the student population. 

White students have a 5.1% suspension rate compared to 6.2% for Latinx students and 18.1% for Black students. __Black students are being suspended at more than triple the rate of White students in AVUHSD__, showing how students of color are disproportionately losing time in the classroom. __Students with disabilities also have a high suspension rate at 13.7%__. 

In LA county, Black students also have the highest suspension rates of all student groups at 5.6%, while Latinx students have a 1.9% suspension rate.

Expulsion rates in AVUHSD show similar trends although rates in a vacuum are not high. Black students have the highest expulsion rate out of all student groups, while White students have the lowest.

In AVUHSD, __only 60.4% of students with disabilities are graduating__, while 80.4% of White students are graduating. __Graduation rates for Latinx students in AVUHSD are lower compared to county-wide rates.__ The graduation rate for Latinx students in AVUHSD is 79.4%, while the Latinx student graduation rate in LA county is 85.6%. AVUHSD should be investing more of its resources in supporting its students academic success as opposed to removing them from classrooms. 

```{r}
#la county tables
susp_lac<-dbGetQuery( con_rc, "SELECT * FROM v7.arei_educ_suspension_county_2025 WHERE county_id = '06037'")%>%
   select(contains("_rate"))%>%
  pivot_longer(cols = 1:9, names_to = "var", values_to="value")

grad_lac<-dbGetQuery( con_rc, "SELECT * FROM v7.arei_educ_hs_grad_county_2025 WHERE county_id = '06037'")%>%
   select(contains("_rate"))%>%
  pivot_longer(cols = 1:9, names_to = "var", values_to="value")
  
# School analysis tables
expulsions<-dbGetQuery(con, "SELECT * FROM analysis_expulsions")
grad<-dbGetQuery(con, "SELECT * FROM analysis_graduation")
suspension<-dbGetQuery(con, "SELECT * FROM analysis_suspensions")

```

## B.	Rather than getting more time in classrooms, these students are being forced to interact more with law enforcement and funneled into the school-to-prison-pipeline 

Law enforcement stopped 904 people in AVUHSD between 2018-2023. Law enforcement responded to a call for service for 317 of the 904 people stopped, or 35% of all people stopped. In other words, law enforcement chose to stop students in 65% of stops (587 of 904).

Black students are over-policed in AVUHSD. __People perceived as Black made up 53.2% of all stops in AVUHSD__ but their __enrollment rate in 2024-2025 is only 16.6%__. Stated another way, __for every 1,000 Black students enrolled in AVUHSD 131.9 Black students are stopped by police__. 

Students perceived as Latinx made up 38.2% of all stops in AVUHSD, and the current enrollment rate of Latinx students is 67.2%. __Latinx students have the second highest rate of stops out of all student groups__.

Students perceived as White made up 7.9% of all stops in AVUHSD but their current enrollment rate is 8.9%. 

When looking at stops that are calls for service versus stops that are not calls for service, we see that students perceived as Black have a higher count of stops that were not a call for service compared to a call for service. Out of all people stopped for a stop that was not a call for service in AVUHSD, 58.2% of those people were perceived as Black. In other words, __more than half of the people being stopped without a call for service in AVUHSD are perceived as Black.__ Conversely, only 5.1% of people perceived as White are stopped for a stop that is not a call for service. 

Students with disabilities make up 2.5% of all stops in AVUHSD, or a total of __23 students with disabilities were stopped__ according to police officer's own data between 2018-2023. It is important to note that police stops of students with disabilities is severely under-counted, as reported by several external sources.

The table below shows the stop reasons for the 23 people with disabilities who were stopped and recorded in the RIPA data set.

```{r}

stops_disability_avuhsd<-dbGetQuery(con, "SELECT * FROM analysis_stops_disability_avuhsd")
stops_race_avuhsd<-dbGetQuery(con, "SELECT * FROM analysis_stops_race_avuhsd")

```

```{r}

### EXPLORE STOP REASONS for the students with disablities ###


# incidents
lasd_incidents <- dbGetQuery(con_shared, "SELECT * FROM crime_and_justice.lasd_stops_incident_2018_2023
WHERE school_name
IN (
'Antelope Valley High',
'Antelope Valley Union High',
'Eastside High',
'Highland High',
'William J. (Pete) Knight High',
'Lancaster High',
'Littlerock High',
'Palmdale High',
'Quartz Hill High',
'R. Rex Parris High',
'Desert Winds Continuation High',
'Phoenix High Community Day',
'Phoenix Continuation'
)
ORDER BY school_name
")

# persons
lasd_persons <- dbGetQuery(con_shared, "SELECT * FROM crime_and_justice.lasd_stops_person_2018_2023")


############### Select columns of interest ########################

av_stops <- lasd_incidents %>% left_join(lasd_persons, by = "contact_id")

av_disabled <- av_stops %>% filter(no_disabilities %in% c("false", "No"))%>%
  select(reason_for_contact, reason_for_contact_narrative)%>%
  rename("Reason for contact detail"="reason_for_contact_narrative")%>%
    rename_with(~ str_replace_all(.x, "_", " ") %>%
                str_to_lower() %>%
                str_replace("^\\w", ~ toupper(.x)))

# Make table:

  flextable(av_disabled) %>%
  set_caption('Stops of students with disabilities in AVUHSD by Stop Reason') %>%
  theme_vanilla() %>%
  width(width=3.5,unit="in")


```

Examining the __stop reasons for people stopped in AVUHSD__, nearly half of stops were for __school fights__ and __smoking marijuana__, neither of which should require law enforcement.

Whether in response to a call or by officer choice, law enforcement said there was a __reasonable suspicion__ that the person was engaged in criminal activity in roughly __90% of stops of students__. The other 10% of stops were because of a consensual encounter and search, to determine if a student violated a school policy, to determine whether a student in truant, an outstanding arrest warrant, a possible Ed Code violation, or traffic violation.

Whether a student __violated a school policy or Ed Code__ should be investigated by school staff NOT law enforcement. That was __4.2% of the stop reasons for people stopped in AVUHSD.__

```{r}
stops_reason_avuhsd<-dbGetQuery(con, "SELECT * FROM analysis_stops_reason_avuhsd WHERE geography = 'Antelope Valley Union High School District'")%>%
  filter(universe=='All stops')%>%
  arrange(-stops_reason_rate)%>%
  select(geography, reason_for_contact, stops_reason_count, stops_reason_rate)%>%
  mutate(stops_reason_rate=round(stops_reason_rate,1))%>%
  rename("Count"="stops_reason_count",
         "Rate"="stops_reason_rate")%>%
      rename_with(~ str_replace_all(.x, "_", " ") %>%
                str_to_lower() %>%
                str_replace("^\\w", ~ toupper(.x)))


  flextable(stops_reason_avuhsd) %>%
  set_caption('Stops of students in AVUHSD by stop reason') %>%
  theme_vanilla() %>%
  width(width=2,unit="in")
  
 
```
 
Out of all people stopped in AVUHSD, __13% were stopped because the officer had a reasonable suspicion that the person was engaged in criminal activity__ were due to the __student matching the a description__. Stops where someone matches a description are fraught with error.

Law enforcement also stopped students for __a number unnecessary reasons__ including disrupting classwork, disruption of school activities, willfully disturbing a school zone, loud noise, litter, jaywalking, bothering other children, possessing unlawful paraphernalia. Out of all people stopped in AVUHSD, __15.2% were stopped for fighting in a public place__ and __12.3% were stopped for possession of marijuana on school grounds__. 


```{r}

stops_reason_rs_avuhsd<-dbGetQuery(con, "SELECT * FROM analysis_stops_reason_rs_avuhsd")
 
  # change denominator to be out of all people stopped: 904 
df<-  stops_reason_rs_avuhsd%>%
  rename("Reasonable suspicion detail"="reasonable_suspicion_reason")%>%
  mutate(total=904,
         rate=round(count/904*100, 1))%>%
  arrange(-rate)%>%
  rename_with(~ str_replace_all(.x, "_", " ") %>%
                str_to_lower() %>%
                str_replace("^\\w", ~ toupper(.x)))

 flextable(df) %>%
  set_caption('Stops of people in AVUHSD for Reasonable Suspicion by Reason Detail') %>%
  theme_vanilla() %>%
  width(width=2,unit="in")

```


```{r, include=FALSE}
stops_reason_rs_codes_avuhsd<-dbGetQuery(con, "SELECT * FROM analysis_stops_reason_rs_codes_avuhsd")%>%
  slice(1:9)%>%
  select(-deactive)%>%
  mutate(total=904,
         rate=round(count/904*100, 1))

 flextable(stops_reason_rs_codes_avuhsd) %>%
  set_caption('Stops of students for Reasonable Suspicion by Offense Code') %>%
  theme_vanilla() %>%
  width(width=2,unit="in")

```

When examining what the __stop results are for people stopped in AVUHSD__, the most common stop result is __in field cite and release__, followed by some form of __contacting a guardian or school administrator__. Police action is not necessary for student behaviors that require guardian or school administrator referrals.  

```{r}


stops_result_avuhsd<-dbGetQuery(con, "SELECT * FROM analysis_stops_result_avuhsd") %>%
  mutate(rate=round(as.numeric(rate), 1))%>%
    mutate(stop_result = str_replace(stop_result, "^\\s*\\w", ~ toupper(.x)))%>%
    rename_with(~ str_replace_all(.x, "_", " ") %>%
                str_to_lower() %>%
                str_replace("^\\w", ~ toupper(.x)))

  flextable(stops_result_avuhsd) %>%
  set_caption('Results of Stops of People in AVUHSD Schools') %>%
  theme_vanilla() %>%
  width(width=2,unit="in")
  
```

Officers can provide an offense code to accompany a stop that resulted in an in field cite and release which gives more detail about the in field citation. __Officers did not provide an offense code for nearly half of the people they stopped__ and gave an in field cite and release. Out of all people officers gave an in field cite and release, __41% were for fighting or possession of marijuana__.  

```{r, include=FALSE}

infield<-av_stops%>%select(contact_id, person_id, result_of_contact_in_field_cite_and_release, result_of_contact_in_field_cite_and_release_offense_codes)%>%
  group_by(result_of_contact_in_field_cite_and_release_offense_codes)%>%
  summarise(count=n())%>%
  arrange(-count)

# Grab offense codes from the Fresno RIPA db

codes<-dbGetQuery(con_fresno, "SELECT * FROM cadoj_ripa_offense_codes_2023")

codes_unique_active <- codes %>%
    # filter(is.na(offense_repealed)) %>% # remove repealed offenses
  # filter(!changes %in% c("REMOVED","REPEALED"))%>%
  group_by(offense_statute) %>%
  summarise(offense_type_of_charge=paste(offense_type_of_charge, collapse="; "),
            statute_literal_25=paste(statute_literal_25,collapse="; "))

# focus just on top counts 

infield_top<-infield%>%
  slice(1:13)%>%
  left_join(codes_unique_active, by=c("result_of_contact_in_field_cite_and_release_offense_codes"="offense_statute"))%>%
  select(-offense_type_of_charge)%>%
  rename("offense code"="result_of_contact_in_field_cite_and_release_offense_codes")

  flextable(infield_top) %>%
  set_caption('Top in field cite and release codes') %>%
  theme_vanilla() %>%
  width(width=2,unit="in")%>%
  width(j = "statute_literal_25", width =5)%>%
    width(j = "offense code", width =.5)%>%
     width(j = "count", width =2)
  

```

Instead of contributing to student safety, police are actively harming students in AVUHSD. __Out of 100 people stopped in AVUHSD, 19.7 are handcuffed by police__. This extreme police action is excessive and traumatizing to students, especially in a school setting. Police's own data show that their actions are not contributing to safety. Out of 100 people stopped by police in AVUHSD, 19.6 were searched. However, __out of all the people that police searched, 72.9% yielded no contraband.__ In other words, the overwhelming majority of students that are being searched by police on school grounds were not harboring illegal contraband. Yet the students have to live with the experience of being searched by police at school.

## C.	LASD’s racially discriminatory practices apply to AV youth outside the classroom as well

In 2023 LASD stopped 31,818 people in the AV. Of all people stopped, 6,974 people were stopped for a call for service, or only 22% of all people stopped. Conversely, __24,844 people were stopped in an officer-initiated stop__, or __78% of all people stopped__. 

Black people in the AV are disproportionately stopped relative to their total population. We see that __31.6% of all stops in the AV are of people perceived as Black__, while __only 14.8% of the AV's population is Black__. This disproportionality is also reflected in stops of students perceived as Black relative to Black student enrollment in AVUHSD schools. 

We also see a __high rate of Latinx people being stopped by police in the AV__, as they make up 47.4% of all stops in the AV. While 53.6% of AV's population is Latinx that is still a high burden of stops being experienced by the Latinx community.

Conversely, __24% of the AV's general population is White__ yet __people perceived as White only make up 18.5% of all AV stops__, indicating that there is racial bias in who is being stopped by police in the AV. 


```{r}

# RIPA analysis tables: SPA 1

stops_age<-dbGetQuery(con, "SELECT * FROM analysis_stops_age")
stops_race<-dbGetQuery(con, "SELECT * FROM analysis_stops_race")
stops_age_race<-dbGetQuery(con, "SELECT * FROM analysis_stops_age_by_race")

```

Examining stop reasons for people stopped in the AV, the most common stop reason for anyone above the age of 17 is traffic violations. This is consistent with police stop behavior in county-wide and other jurisdictions. 

```{r}

stops_stops_reason_age<-dbGetQuery(con, "SELECT * FROM analysis_stops_reason_age")
stops_stops_reason_age_race<-dbGetQuery(con, "SELECT * FROM analysis_stops_reason_age_race")

```
